(()=>{"use strict";var e="wff-cohort-35",t="cfe95dc6-b954-4a9f-a787-16df5abb597c",n="https://nomoreparties.co/v1/",r=function(e){return e.ok?e.json():Promise.reject("Сервер ответил: ".concat(e.status))};function o(e,t,n,r,o){var c=document.querySelector("#card-template").content.querySelector(".card").cloneNode(!0),a=c.querySelector(".card__image");a.src=e.link,a.alt=e.name,c.querySelector(".card__title").textContent=e.name;var i=c.querySelector(".card__like-count");i.textContent=e.likes.length;var u=c.querySelector(".card__like-button");e.likes.some((function(e){return e._id===o}))?u.classList.add("card__like-button_is-active"):u.classList.remove("card__like-button_is-active"),u.addEventListener("click",(function(){t(u,e._id,i)}));var l=c.querySelector(".card__delete-button");return e.owner._id===o?(l.style.display="block",l.addEventListener("click",(function(){return n(c,e._id)}))):l.style.display="none",a.addEventListener("click",(function(){return r(a)})),c}function c(o,c,a){var i=o.classList.contains("card__like-button_is-active");parseInt(a.textContent,10),i?function(o){return fetch(n+e+"/cards/likes/"+o,{method:"DELETE",headers:{Authorization:t}}).then(r)}(c).then((function(e){a.textContent=e.likes.length,o.classList.remove("card__like-button_is-active")})).catch((function(e){console.error(e),alert("Ошибка при удалении лайка.")})):function(o){return fetch(n+e+"/cards/likes/"+o,{method:"PUT",headers:{Authorization:t}}).then(r)}(c).then((function(e){a.textContent=e.likes.length,o.classList.add("card__like-button_is-active")})).catch((function(e){console.error(e),alert("Ошибка при добавлении лайка.")}))}function a(o,c){var a;(a=c,fetch(n+e+"/cards/"+a,{method:"DELETE",headers:{Authorization:t}}).then(r)).then((function(){o.remove()})).catch((function(e){console.error("Ошибка при удалении карточки:",e)}))}function i(e){e.classList.add("popup_is-opened"),e.classList.remove("popup_is-animated"),document.addEventListener("keydown",l),e.addEventListener("click",s)}function u(e){e.classList.remove("popup_is-opened"),e.classList.add("popup_is-animated"),document.removeEventListener("keydown",l),e.removeEventListener("click",s)}function l(e){if("Escape"===e.key){var t=document.querySelector(".popup_is-opened");t&&u(t)}}function s(e){e.target===e.currentTarget&&u(e.currentTarget)}var p=function(e,t,n){var r=e.querySelector("#".concat(t.id,"-error"));t.classList.remove(n.inputErrorClass),r.classList.remove(n.errorClass),r.textContent=""},d=function(e,t,n){f(e)?(t.disabled=!0,t.classList.add(n.inactiveButtonClass)):(t.disabled=!1,t.classList.remove(n.inactiveButtonClass))},f=function(e){return e.some((function(e){return!e.validity.valid}))},_=function(e,t){var n=Array.from(e.querySelectorAll(t.inputSelector)),r=e.querySelector(t.submitButtonSelector);n.forEach((function(n){return p(e,n,t)})),d(n,r,t)};function y(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}var m=document.querySelector(".profile__edit-button"),v=document.querySelector(".profile__add-button"),h=document.querySelector(".places__list"),S=document.querySelector(".popup_type_edit"),b=document.querySelector(".popup_type_new-card"),q=document.querySelector('.popup__form[name="edit-profile"]'),g=q.querySelector(".popup__input_type_name"),L=q.querySelector(".popup__input_type_description"),k=document.querySelector(".profile__title"),C=document.querySelector(".profile__description"),E=document.querySelector(".profile__image"),A=document.querySelector('.popup__form[name="new-place"]'),x=document.querySelector(".popup_type_avatar"),T=document.querySelector('.popup__form[name="update-avatar"]'),j=T.querySelector(".popup__input_type_avatar-url"),w=document.querySelector(".profile__avatar-container"),z=document.querySelector(".popup_type_image"),I=z.querySelector(".popup__image"),O=z.querySelector(".popup__caption"),B={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"};function D(e){I.src=e.src,I.alt=e.alt,O.textContent=e.alt,i(z)}function P(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"Сохранить",r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"Сохранение...";e.textContent=t?r:n,e.disabled=t}var M,N=null;Promise.all([fetch(n+e+"/users/me",{headers:{Authorization:t}}).then(r),fetch(n+e+"/cards",{headers:{Authorization:t}}).then(r)]).then((function(e){var t,n,r=(n=2,function(e){if(Array.isArray(e))return e}(t=e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,c,a,i=[],u=!0,l=!1;try{if(c=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;u=!1}else for(;!(u=(r=c.call(n)).done)&&(i.push(r.value),i.length!==t);u=!0);}catch(e){l=!0,o=e}finally{try{if(!u&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(l)throw o}}return i}}(t,n)||function(e,t){if(e){if("string"==typeof e)return y(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?y(e,t):void 0}}(t,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),i=r[0],u=r[1];N=i._id,k.textContent=i.name,C.textContent=i.about,E.style.backgroundImage="url(".concat(i.avatar,")"),u.forEach((function(e){var t=o(e,c,(function(e,t){return a(e,t)}),D,N);h.append(t)}))})).catch((function(e){console.error("Ошибка загрузки данных:",e)})),w.addEventListener("click",(function(){T.reset(),i(x),_(T,B)})),v.addEventListener("click",(function(){i(b),_(A,B)})),m.addEventListener("click",(function(){g.value=k.textContent,L.value=C.textContent,i(S),_(q,B)})),document.querySelectorAll(".popup__close").forEach((function(e){e.addEventListener("click",(function(){u(e.closest(".popup"))}))})),T.addEventListener("submit",(function(o){(function(o,c,a,i){o.preventDefault();var l,s=c.value,p=o.target.querySelector(".popup__button");P(p,!0),(l=s,fetch(n+e+"/users/me/avatar",{method:"PATCH",headers:{Authorization:t,"Content-Type":"application/json"},body:JSON.stringify({avatar:l})}).then(r)).then((function(e){a.style.backgroundImage="url(".concat(e.avatar,")");var t=document.querySelector(".profile__image");t&&(t.style.backgroundImage="url(".concat(e.avatar,")")),o.target.reset(),u(i)})).catch((function(e){console.error("Ошибка обновления аватара:",e)})).finally((function(){P(p,!1)}))})(o,j,w,x),_(T,B)})),q.addEventListener("submit",(function(o){(function(o,c,a,i,l,s){o.preventDefault();var p,d,f=c.value,_=a.value,y=o.target.querySelector(".popup__button");P(y,!0),(p=f,d=_,fetch(n+e+"/users/me",{method:"PATCH",headers:{Authorization:t,"Content-Type":"application/json"},body:JSON.stringify({name:p,about:d})}).then(r)).then((function(e){i.textContent=e.name,l.textContent=e.about,u(s)})).catch((function(e){console.error("Ошибка редактирования профиля:",e)})).finally((function(){P(y,!1)}))})(o,g,L,k,C,S),_(q,B)})),A.addEventListener("submit",(function(i){(function(o,c,a,i,l,s,p,d,f){o.preventDefault();var _,y=c.querySelector(".popup__input_type_card-name"),m=c.querySelector(".popup__input_type_url"),v={name:y.value,link:m.value},h=c.querySelector(".popup__button");P(h,!0),(_=v,fetch(n+e+"/cards",{method:"POST",headers:{Authorization:t,"Content-Type":"application/json"},body:JSON.stringify(_)}).then(r)).then((function(e){var t=i(e,d,(function(e,t){return l(e,t)}),s,f);a.prepend(t),c.reset(),u(p)})).catch((function(e){console.error("Ошибка добавления карточки:",e)})).finally((function(){P(h,!1)}))})(i,A,h,o,a,D,b,c,N),_(A,B)})),M=B,Array.from(document.querySelectorAll(M.formSelector)).forEach((function(e){e.addEventListener("submit",(function(e){e.preventDefault()})),function(e,t){var n=Array.from(e.querySelectorAll(t.inputSelector)),r=e.querySelector(t.submitButtonSelector);d(n,r,t),n.forEach((function(o){o.addEventListener("input",(function(){!function(e,t,n){t.validity.patternMismatch?t.setCustomValidity(t.dataset.errorMessage):t.setCustomValidity(""),t.validity.valid?p(e,t,n):function(e,t,n,r){var o=e.querySelector("#".concat(t.id,"-error"));t.classList.add(r.inputErrorClass),o.textContent=n,o.classList.add(r.errorClass)}(e,t,t.validationMessage,n)}(e,o,t),d(n,r,t)}))}))}(e,M)}))})();